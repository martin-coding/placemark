{{> menu}}

<section class="section has-background-light">
  <div class="container">

    <div class="box level">
      <div class="level-left">
        <div>
          <h1 class="title is-3">{{location.title}}</h1>
          <p class="subtitle is-6 has-text-grey">{{location.category}} · {{location.visibility}}</p>
        </div>
      </div>
      {{#if false}}
      <div class="level-right">
        <div class="buttons">
          <button class="button is-warning" onclick="toggleEdit()">
            <span class="icon">
              <i class="far fa-edit"></i>
            </span>
            <span>Edit</span>
          </button>
        </div>
      </div>
      {{/if}}
    </div>

    <div class="columns">

      <div class="column is-5">
        <div class="card">

          {{#if location.img}}
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="{{location.img}}" alt="{{location.title}}">
              </figure>
            </div>
          {{else}}
            <div class="card-image">
              <figure class="image is-4by3">
                <img src="https://bulma.io/images/placeholders/1280x960.png">
              </figure>
            </div>
          {{/if}}

          {{#if canEdit }}
          <div class="card-content">
            <form action="/location/{{location._id}}/uploadimage" method="POST" enctype="multipart/form-data">
              <div class="file has-name is-fullwidth">
                <label class="file-label">
                  <input class="file-input" name="imagefile" type="file" accept="image/png, image/jpeg" />
                  <span class="file-cta">
                    <span class="file-icon">
                      <i class="fas fa-upload"></i>
                    </span>
                    <span class="file-label">Choose image…</span>
                  </span>
                  <span class="file-name">No file selected</span>
                </label>
              </div>
              <button type="submit" class="button is-link is-fullwidth mt-3">Upload Image</button>
            </form>
          </div>
          {{/if}}
        </div>
      </div>

      <div class="column is-7">

        <div class="columns">
          <div class="column">
            <div class="box">
              <p class="heading">Latitude</p>
              <p class="title is-6">{{location.latitude}}</p>
            </div>
          </div>
          <div class="column">
            <div class="box">
              <p class="heading">Longitude</p>
              <p class="title is-6">{{location.longitude}}</p>
            </div>
          </div>
        </div>

        <div class="box">
          <h2 class="title is-5">Description</h2>
          <p>{{location.description}}</p>
        </div>

      </div>
    </div>

    {{> review-form}}

    <div class="box">
      <h2 class="title is-5">Reviews</h2>

      {{#if reviews.length}}
        {{> list-reviews}}
      {{else}}
        <p class="has-text-grey">No reviews yet. Be the first to review this place.</p>
      {{/if}}
    </div>

    {{#if canEdit}}
    <form action="/dashboard/deletelocation/{{location._id}}" method="POST">
      <button
        type="submit"
        class="button is-danger is-light"
        onclick="return confirm('Are you sure you want to delete this location? This action cannot be undone.');">
        <span class="icon">
          <i class="fas fa-trash"></i>
        </span>
        <span>Delete Location</span>
      </button>
    </form>
    {{/if}}
  </div>
</section>

<script>
  const fileInput = document.querySelector(".file-input");
  if (fileInput) {
    fileInput.onchange = () => {
      if (fileInput.files.length > 0) {
        document.querySelector(".file-name").textContent = fileInput.files[0].name;
      }
    };
  }
</script>
